{"version":3,"file":"index.modern.js","sources":["../services/models.ts","../shared/operators.ts","../state/notified.ts","../state/observed.ts","../state/index.ts","../state/injector.ts","../state/store.ts","../services/publish-service/publish-service.ts","../services/auth-service/auth-service.ts","../services/masto-auth-service/masto-auth-service.ts","../components/login/chaos-login.ts","../components/logout/chaos-logout.ts","../components/login/chaos-masto-login.ts","../components/logout/chaos-masto-logout.ts","../components/filter/chaos-filter.ts","../components/resizer/chaos-resizer.ts","../components/on-this-day/chaos-on-this-day.ts","../components/color-switch/chaos-color-switch.ts","../components/file/chaos-panel.ts","../components/file/chaos-panel-option.ts","../index.ts"],"sourcesContent":["export interface Response<T> {\n\tsuccess: boolean;\n\tmessage: string;\n\tcontent: T;\n}\n\nexport interface MastoAuthResult {\n\tauthenticationUri: string;\n}\n\nexport interface AuthResult {\n\ttoken: string;\n}\n\nexport interface ChangeRequest {\n\tpath: string;\n\tbody: string;\n\tfrontmatter: object;\n\ttoken: string;\n}\n\nexport interface ChangeResult {\n\tpath: string;\n\tbody: string;\n\tfrontmatter: object;\n}\n\nexport interface ChangeOption {\n\tkey: string;\n\tname: string;\n\tvalue: SupportedPanelTypes;\n\ttype: PanelOptionType;\n\trequired: boolean;\n}\n\nexport type SupportedPanelTypes = string | string[] | boolean;\n\nexport enum PanelStatus {\n\tCREATING = \"Create\",\n\tEDITING = \"Edit\",\n\tSAVING = \"Save\",\n}\n\nexport enum PanelOptionType {\n\tTEXT = \"text\",\n\tLIST = \"list\",\n\tBOOLEAN = \"boolean\",\n}\n\nexport enum PanelType {\n\tPLANT = \"plant\",\n\tQUIP = \"quip\",\n\tLOG = \"log\",\n\tSTONE = \"stone\",\n}\n","import { AuthResult, PanelType } from \"../services/models\";\n\nexport function getUrlFromHead(rel: string): string {\n\tconst match = Array.from(document.head.children).find(\n\t\t(x) => (x as HTMLAnchorElement).rel === rel\n\t);\n\treturn (<HTMLAnchorElement>match).href;\n}\n\nexport function getFilePathByDate(panelType: PanelType): string {\n\tconst prependZero = (x) => (x < 10 ? `0${x}` : x.toString());\n\tconst now = new Date();\n\tconst y = now.getFullYear().toString();\n\tconst m = prependZero(now.getMonth() + 1);\n\tconst d = now.getDate();\n\tconst h = prependZero(now.getHours());\n\tconst mi = prependZero(now.getMinutes());\n\tconst s = prependZero(now.getSeconds());\n\n\treturn panelType === PanelType.LOG\n\t\t? `/logs/${y}/${m}/${y}${m}${d}-${h}${mi}${s}`\n\t\t: `/quips/${y}${m}${d}-${h}${mi}${s}`;\n}\n\nexport function getSimpleDate(now: Date): string {\n\tconst prependZero = (x) => (x < 10 ? `0${x}` : x.toString());\n\tconst y = now.getFullYear();\n\tconst m = prependZero(now.getMonth() + 1);\n\tconst d = now.getDate();\n\treturn [y, m, d].join(\"-\");\n}\n\nexport function mapClass(args: string[]): string {\n\treturn args?.length > 0 ? `class=\"${args.join(\" \")}\"` : \"\";\n}\n\nexport function authorized(token: string): Promise<boolean> {\n\tconst baseUri = getUrlFromHead(\"publish\");\n\tif (token == null || !baseUri)\n\t\treturn new Promise((resolve, reject) => resolve(false));\n\n\tconst headers = new Headers();\n\theaders.append(\"Authorization\", `Bearer ${token}`);\n\treturn fetch(new URL(\"auth\", baseUri), { headers }).then(\n\t\t(r) => {\n\t\t\tif (r.status !== 200) return false;\n\t\t\tsessionStorage.setItem(\"token\", token);\n\t\t\treturn true;\n\t\t},\n\t\t(err) => {\n\t\t\treturn false;\n\t\t}\n\t);\n}\n\nexport function mastodonAuthorized(\n\ttoken: string,\n\tcode: string,\n\tredirect: string\n): Promise<boolean> {\n\tconst baseUri = getUrlFromHead(\"publish\");\n\tif (!baseUri) return new Promise((resolve, reject) => resolve(false));\n\n\tconst headers = new Headers();\n\theaders.append(\"Authorization\", `Bearer ${token}`);\n\theaders.append(\"Content-Type\", \"application/json; charset=UTF-8\");\n\treturn fetch(\n\t\tnew URL(`mastodon/redirect?code=${code}&redirect=${redirect}`, baseUri),\n\t\t{\n\t\t\theaders,\n\t\t}\n\t)\n\t\t.then((r) => (r.status === 200 ? r.json() : null))\n\t\t.then((r) => <AuthResult>r)\n\t\t.then(\n\t\t\t(r) => {\n\t\t\t\tif (r?.token == null) return false;\n\t\t\t\tsessionStorage.setItem(\"mastotoken\", r.token);\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t);\n}\n","export class Notified {\n\tprotected _subscribers: Map<string, Function> = new Map<string, Function>();\n\n\tpublic subscribe(subscriber: string, callback: Function): string {\n\t\tconst sub = `${subscriber}-${Math.random()}`;\n\t\tthis._subscribers.set(sub, callback);\n\t\treturn sub;\n\t}\n\n\tpublic unsubscribe(sub: string) {\n\t\tdelete this._subscribers[sub];\n\t}\n\n\tpublic notify() {\n\t\tthis._subscribers.forEach((callback, sub) => callback());\n\t}\n}\n","import { Notified } from \"./notified\";\n\nexport class Observed<T> extends Notified {\n\tprotected _value: T;\n\n\tpublic get value(): T {\n\t\treturn this._value;\n\t}\n\n\tpublic set value(v: T) {\n\t\tthis._value = v;\n\t\tthis.notify();\n\t}\n\n\tpublic notify() {\n\t\tthis._subscribers.forEach((callback, sub) => callback(this._value));\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t}\n}\n","import { Store } from \"./store\";\n\nexport default new Store();\n","import { PublishService, AuthService, MastoAuthService } from \"../services/index\";\nimport store from \"./index\";\n\nexport enum Instances {\n\tPUBLISH = \"publish-service\",\n\tAUTH = \"auth-service\",\n\tMASTOAUTH = \"masto-auth-service\",\n\tSTORE = \"store-state\",\n}\n\nexport const InjectorMap = new Map<string, object>([\n\t[Instances.PUBLISH, new PublishService()],\n\t[Instances.AUTH, new AuthService()],\n\t[Instances.MASTOAUTH, new MastoAuthService()],\n\n\t// I use the runtime store instead of a new implementation\n\t// because services have internal dependencies on store and\n\t// I don't want them to require injection right now\n\t[Instances.STORE, store],\n]);\n\nexport interface InjectionRequest {\n\tinstance: Instances;\n\tcallback: Function;\n}\n\nexport function buildRequest(request: InjectionRequest) {\n\treturn new CustomEvent(\"chaos-request\", {\n\t\tbubbles: true,\n\t\tcomposed: true,\n\t\tdetail: request,\n\t});\n}\n","import { authorized, mastodonAuthorized } from \"../shared/operators\";\nimport { Notified } from \"./notified\";\nimport { Observed } from \"./observed\";\n\nexport class Store {\n\t// authentication\n\tpublic isAuthorized$ = new Observed<boolean>();\n\tpublic isMastodonAuthorized$ = new Observed<boolean>();\n\n\t// filtering\n\tpublic onFieldFilter$ = new Notified();\n\n\tpublic get token(): string {\n\t\treturn sessionStorage.getItem(\"token\");\n\t}\n\n\tpublic get mastodonToken(): string {\n\t\treturn sessionStorage.getItem(\"mastotoken\");\n\t}\n\n\tconstructor() {\n\t\t// page load sets initial authorized state\n\t\tauthorized(this.token).then((isAuth) => {\n\t\t\tthis.isAuthorized$.value = isAuth;\n\t\t});\n\n\t\t// responds to messages sent from the second window\n\t\twindow.addEventListener(\"message\", (ev) => {\n\t\t\tconst e = <MessageEvent>ev;\n\t\t\tif (e.isTrusted && e.data) {\n\t\t\t\tconst redirect = document.location.href;\n\t\t\t\tmastodonAuthorized(this.token, e.data, redirect).then((isAuth) => {\n\t\t\t\t\tthis.isMastodonAuthorized$.value = isAuth;\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// if Mastodon has redirected a code from its OAuth flow, use the code to retrieve a token\n\t\tconst params = new URLSearchParams(document.location.search);\n\t\tif (params.has(\"code\")) {\n\t\t\t// sends code back to original window that made the authorization request\n\t\t\twindow.opener.postMessage(params.get(\"code\"), document.location.origin);\n\t\t\twindow.close();\n\t\t}\n\t}\n}\n","import { getUrlFromHead } from \"../../shared/operators\";\nimport { Response, ChangeResult } from \"../models\";\nimport store from \"../../state/index\";\n\nexport class PublishService {\n\tcreate(\n\t\ttoken: string,\n\t\tpayload: ChangeResult\n\t): Promise<Response<ChangeResult>> {\n\t\tif (token == null)\n\t\t\tnew Promise((resolve, reject) =>\n\t\t\t\tresolve(<Response<ChangeResult>>{\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: \"no token passed to create\",\n\t\t\t\t})\n\t\t\t);\n\n\t\tconst baseUri = getUrlFromHead(\"publish\");\n\t\tif (!baseUri)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(<Response<ChangeResult>>{\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: \"missing publish uri in head\",\n\t\t\t\t})\n\t\t\t);\n\n\t\tconst headers = new Headers();\n\t\theaders.append(\"Authorization\", `Bearer ${token}`);\n\t\theaders.append(\"Content-Type\", \"application/json; charset=UTF-8\");\n\t\treturn fetch(new URL(\"file\", baseUri), {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: JSON.stringify(payload),\n\t\t\theaders,\n\t\t})\n\t\t\t.then((r) => (r.status === 200 ? r.json() : null))\n\t\t\t.then((b) => <Response<ChangeResult>>b);\n\t}\n\n\tread(token: string, filePath: string): Promise<Response<ChangeResult>> {\n\t\tif (token == null)\n\t\t\tnew Promise((resolve, reject) =>\n\t\t\t\tresolve(<Response<ChangeResult>>{\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: \"no token passed to read\",\n\t\t\t\t})\n\t\t\t);\n\n\t\tconst baseUri = getUrlFromHead(\"publish\");\n\t\tif (!baseUri)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(<Response<ChangeResult>>{\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: \"missing publish uri in head\",\n\t\t\t\t})\n\t\t\t);\n\n\t\tconst headers = new Headers();\n\t\theaders.append(\"Authorization\", `Bearer ${token}`);\n\t\treturn fetch(new URL(`file?path=${filePath}`, baseUri), {\n\t\t\theaders,\n\t\t})\n\t\t\t.then((r) => (r.status === 200 ? r.json() : null))\n\t\t\t.then((b) => <Response<ChangeResult>>b);\n\t}\n\n\tupdate(\n\t\ttoken: string,\n\t\tpayload: ChangeResult\n\t): Promise<Response<ChangeResult>> {\n\t\tif (token == null)\n\t\t\tnew Promise((resolve, reject) =>\n\t\t\t\tresolve(<Response<ChangeResult>>{\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: \"no token passed to update\",\n\t\t\t\t})\n\t\t\t);\n\n\t\tconst baseUri = getUrlFromHead(\"publish\");\n\t\tif (!baseUri)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(<Response<ChangeResult>>{\n\t\t\t\t\tsuccess: false,\n\t\t\t\t\tmessage: \"missing publish uri in head\",\n\t\t\t\t})\n\t\t\t);\n\n\t\tconst headers = new Headers();\n\t\theaders.append(\"Authorization\", `Bearer ${token}`);\n\t\theaders.append(\"Content-Type\", \"application/json; charset=UTF-8\");\n\t\treturn fetch(new URL(\"file\", baseUri), {\n\t\t\tmethod: \"PUT\",\n\t\t\tbody: JSON.stringify(payload),\n\t\t\theaders,\n\t\t})\n\t\t\t.then((r) => (r.status === 200 ? r.json() : null))\n\t\t\t.then((b) => <Response<ChangeResult>>b);\n\t}\n}\n","import { authorized, getUrlFromHead } from \"../../shared/operators\";\nimport { AuthResult } from \"../models\";\nimport store from \"../../state/index\";\n\nexport class AuthService {\n\tpublic authenticate(username: string, password: string): Promise<string> {\n\t\tif (username == null || password == null)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(\"missing authentication arguments\")\n\t\t\t);\n\n\t\tconst baseUri = getUrlFromHead(\"authentication\");\n\t\tif (!baseUri)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(\"missing authentication uri in head\")\n\t\t\t);\n\n\t\tconst headers = new Headers();\n\t\theaders.append(\"Authorization\", `Basic ${btoa(username + \":\" + password)}`);\n\t\treturn fetch(new URL(\"token\", baseUri), { headers })\n\t\t\t.then((r) => (r.status === 200 ? r.json() : null))\n\t\t\t.then((r) => <AuthResult>r)\n\t\t\t.then(\n\t\t\t\t(r) => {\n\t\t\t\t\tif (r?.token === null) return \"there was a login error\";\n\t\t\t\t\treturn authorized(r.token).then((isAuthorized) => {\n\t\t\t\t\t\tstore.isAuthorized$.value = isAuthorized;\n\t\t\t\t\t\treturn \"\";\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\t(err) => \"there was a login error\"\n\t\t\t);\n\t}\n\n\tpublic unauthenticate() {\n\t\tsessionStorage.removeItem(\"token\");\n\t\tstore.isAuthorized$.value = false;\n\t}\n}\n","import { getUrlFromHead } from \"../../shared/operators\";\nimport { Response, MastoAuthResult } from \"../models\";\nimport store from \"../../state/index\";\n\nexport class MastoAuthService {\n\tpublic authenticate(token: string, redirect: string): Promise<string> {\n\t\tif (token == null || redirect == null)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(\"missing authentication arguments\")\n\t\t\t);\n\n\t\tconst baseUri = getUrlFromHead(\"authentication\");\n\t\tif (!baseUri)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(\"missing authentication uri in head\")\n\t\t\t);\n\n\t\tconst headers = new Headers();\n\t\theaders.append(\"Authorization\", `Bearer ${token}`);\n\t\treturn fetch(new URL(`mastodon/auth?redirect=${redirect}`, baseUri), {\n\t\t\theaders,\n\t\t})\n\t\t\t.then((r) => (r.status === 200 ? r.json() : null))\n\t\t\t.then((r) => <MastoAuthResult>r)\n\t\t\t.then((r) => {\n\t\t\t\tif (r?.authenticationUri != null) {\n\t\t\t\t\twindow.open(r.authenticationUri, \"_blank\");\n\t\t\t\t} else {\n\t\t\t\t\treturn `failed to retrieve authentication URI`;\n\t\t\t\t}\n\t\t\t\treturn \"\";\n\t\t\t});\n\t}\n\n\tpublic unauthenticate(token: string, mastotoken: string): Promise<string> {\n\t\tif (token == null || mastotoken == null)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(\"missing authentication arguments\")\n\t\t\t);\n\n\t\tconst baseUri = getUrlFromHead(\"authentication\");\n\t\tif (!baseUri)\n\t\t\treturn new Promise((resolve) =>\n\t\t\t\tresolve(\"missing authentication uri in head\")\n\t\t\t);\n\n\t\tconst payload = { token: mastotoken };\n\t\tconst headers = new Headers();\n\t\theaders.append(\"Authorization\", `Bearer ${token}`);\n\t\theaders.append(\"Content-Type\", \"application/json; charset=UTF-8\");\n\t\treturn fetch(new URL(\"mastodon/revoke\", baseUri), {\n\t\t\tmethod: \"POST\",\n\t\t\tbody: JSON.stringify(payload),\n\t\t\theaders,\n\t\t})\n\t\t\t.then((r) => (r.status === 200 ? r.json() : null))\n\t\t\t.then((r) => <Response<any>>r)\n\t\t\t.then((r) => {\n\t\t\t\tif (!r.success) return r.message;\n\t\t\t\tsessionStorage.removeItem(\"mastotoken\");\n\t\t\t\tstore.isMastodonAuthorized$.value = false;\n\t\t\t\treturn \"\";\n\t\t\t});\n\t}\n}\n","import { AuthService } from \"../../services/index\";\nimport {\n\tInjectionRequest,\n\tInstances,\n\tbuildRequest,\n} from \"../../state/injector\";\n\nexport class ChaosLogin extends HTMLElement {\n\tprivate _auth: AuthService;\n\n\tget username(): HTMLInputElement {\n\t\treturn <HTMLInputElement>this.querySelector(\"#username\");\n\t}\n\n\tget password(): HTMLInputElement {\n\t\treturn <HTMLInputElement>this.querySelector(\"#password\");\n\t}\n\n\tget errors(): HTMLLabelElement {\n\t\treturn <HTMLLabelElement>this.querySelector(\"#errors\");\n\t}\n\n\tonClick(e: MouseEvent) {\n\t\tconst target = <HTMLButtonElement>e.target;\n\t\tif (target?.type !== \"button\") return;\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tthis._auth\n\t\t\t.authenticate(this.username?.value, this.password?.value)\n\t\t\t.then((msg) => (this.errors.innerText = msg));\n\t}\n\n\trender() {\n\t\tthis.innerHTML = `\n\t\t\t<label for=\"username\">Username:</label>\n\t\t\t<input\n\t\t\t\tid=\"username\"\n\t\t\t\tname=\"username\"\n\t\t\t\tautocomplete=\"username\"\n\t\t\t\ttype=\"text\"\n\t\t\t/>\n\t\t\t<label for=\"password\">Password:</label>\n\t\t\t<input\n\t\t\t\tid=\"password\"\n\t\t\t\tname=\"password\"\n\t\t\t\tautocomplete=\"password\"\n\t\t\t\ttype=\"password\"\n\t\t\t/>\n\t\t\t<button id=\"login\" type=\"button\">Login</button>\n\t\t\t<chaos-logout><p>No logout</p></chaos-logout>\n\t\t\t<label id=\"errors\"></label>\n\t\t`;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tconnectedCallback() {\n\t\tthis.render();\n\n\t\tthis.dispatchEvent(\n\t\t\tbuildRequest(<InjectionRequest>{\n\t\t\t\tinstance: Instances.AUTH,\n\t\t\t\tcallback: (e) => (this._auth = e),\n\t\t\t})\n\t\t);\n\n\t\tthis.addEventListener(\"click\", (e: MouseEvent) => this.onClick(e), false);\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.removeEventListener(\n\t\t\t\"click\",\n\t\t\t(e: MouseEvent) => this.onClick(e),\n\t\t\tfalse\n\t\t);\n\t}\n}\n","import { AuthService } from \"../../services/index\";\nimport { Store } from \"../../state/store\";\nimport {\n\tInjectionRequest,\n\tInstances,\n\tbuildRequest,\n} from \"../../state/injector\";\n\nexport class ChaosLogout extends HTMLElement {\n\tprivate _auth: AuthService;\n\tprivate _store: Store;\n\tprivate _subscription: string;\n\n\tonClick(e: MouseEvent) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tthis._auth.unauthenticate();\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tconnectedCallback() {\n\t\t// placeholder\n\t\tthis.innerHTML = `<button type=\"button\" class=\"fill\" hidden>Logout</button>`;\n\n\t\tconst getAuth = buildRequest(<InjectionRequest>{\n\t\t\tinstance: Instances.AUTH,\n\t\t\tcallback: (e) => (this._auth = e),\n\t\t});\n\n\t\tconst getStore = buildRequest(<InjectionRequest>{\n\t\t\tinstance: Instances.STORE,\n\t\t\tcallback: (e) => (this._store = e),\n\t\t});\n\n\t\tthis.dispatchEvent(getAuth);\n\t\tthis.dispatchEvent(getStore);\n\n\t\tthis._subscription = this._store.isAuthorized$.subscribe(\n\t\t\t\"chaos-logout\",\n\t\t\t(isAuth) => {\n\t\t\t\tthis.innerHTML = isAuth\n\t\t\t\t\t? `<button type=\"button\" class=\"fill\">Logout</button>`\n\t\t\t\t\t: `<button type=\"button\" class=\"fill\" hidden>Logout</button>`;\n\t\t\t}\n\t\t);\n\n\t\tthis.addEventListener(\"click\", (e: MouseEvent) => this.onClick(e), false);\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis._store.isAuthorized$.unsubscribe(this._subscription);\n\t\tthis.removeEventListener(\n\t\t\t\"click\",\n\t\t\t(e: MouseEvent) => this.onClick(e),\n\t\t\tfalse\n\t\t);\n\t}\n}\n","import { MastoAuthService } from \"../../services/index\";\nimport {\n\tInjectionRequest,\n\tInstances,\n\tbuildRequest,\n} from \"../../state/injector\";\nimport { Store } from \"../../state/store\";\n\nexport class ChaosMastoLogin extends HTMLElement {\n\tprivate _mastoauth: MastoAuthService;\n\tprivate _store: Store;\n\tprivate _subscription: string;\n\tprivate _defaultHTML = `\n\t\t<button type=\"button\" class=\"fill\" hidden>Login to Mastodon</button>\n\t\t<label id=\"errors\"></label>\n\t`;\n\n\tget errors(): HTMLLabelElement {\n\t\treturn <HTMLLabelElement>this.querySelector(\"#errors\");\n\t}\n\n\tget redirectUri(): string {\n\t\treturn document.location.href;\n\t}\n\n\tonClick(e: MouseEvent) {\n\t\tconst target = <HTMLButtonElement>e.target;\n\t\tif (target?.type !== \"button\") return;\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\n\t\tthis._mastoauth\n\t\t\t.authenticate(this._store.token, this.redirectUri)\n\t\t\t.then((msg) => (this.errors.innerText = msg));\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tconnectedCallback() {\n\t\t// placeholder\n\t\tthis.innerHTML = this._defaultHTML;\n\n\t\tthis.dispatchEvent(\n\t\t\tbuildRequest(<InjectionRequest>{\n\t\t\t\tinstance: Instances.MASTOAUTH,\n\t\t\t\tcallback: (e) => (this._mastoauth = e),\n\t\t\t})\n\t\t);\n\n\t\tthis.dispatchEvent(\n\t\t\tbuildRequest(<InjectionRequest>{\n\t\t\t\tinstance: Instances.STORE,\n\t\t\t\tcallback: (e) => (this._store = e),\n\t\t\t})\n\t\t);\n\n\t\tthis._subscription = this._store.isAuthorized$.subscribe(\n\t\t\t\"chaos-masto-login\",\n\t\t\t(isAuth) => {\n\t\t\t\tthis.innerHTML = isAuth\n\t\t\t\t\t? `\n\t\t\t\t\t<button type=\"button\" class=\"fill\">Login to Mastodon</button>\n\t\t\t\t\t<chaos-masto-logout></chaos-masto-logout>\n\t\t\t\t\t<label id=\"errors\"></label>\n\t\t\t\t\t`\n\t\t\t\t\t: this._defaultHTML;\n\t\t\t}\n\t\t);\n\n\t\tthis.addEventListener(\"click\", (e: MouseEvent) => this.onClick(e), false);\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis._store.isAuthorized$.unsubscribe(this._subscription);\n\t\tthis.removeEventListener(\n\t\t\t\"click\",\n\t\t\t(e: MouseEvent) => this.onClick(e),\n\t\t\tfalse\n\t\t);\n\t}\n}\n","import { MastoAuthService } from \"../../services/index\";\nimport { Store } from \"../../state/store\";\nimport {\n\tInjectionRequest,\n\tInstances,\n\tbuildRequest,\n} from \"../../state/injector\";\n\nexport class ChaosMastoLogout extends HTMLElement {\n\tprivate _mastoauth: MastoAuthService;\n\tprivate _store: Store;\n\tprivate _subscription: string;\n\tprivate _defaultHTML = `<button type=\"button\" class=\"fill\" hidden>Logout</button>`;\n\n\tonClick(e: MouseEvent) {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tthis._mastoauth.unauthenticate(\n\t\t\tthis._store.token,\n\t\t\tthis._store.mastodonToken\n\t\t);\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tconnectedCallback() {\n\t\tthis.innerHTML = this._defaultHTML;\n\n\t\tthis.dispatchEvent(\n\t\t\tbuildRequest(<InjectionRequest>{\n\t\t\t\tinstance: Instances.MASTOAUTH,\n\t\t\t\tcallback: (e) => (this._mastoauth = e),\n\t\t\t})\n\t\t);\n\n\t\tthis.dispatchEvent(\n\t\t\tbuildRequest(<InjectionRequest>{\n\t\t\t\tinstance: Instances.STORE,\n\t\t\t\tcallback: (e) => (this._store = e),\n\t\t\t})\n\t\t);\n\n\t\tthis._subscription = this._store.isMastodonAuthorized$.subscribe(\n\t\t\t\"chaos-masto-logout\",\n\t\t\t(isAuth) => {\n\t\t\t\tthis.innerHTML = isAuth\n\t\t\t\t\t? `<button type=\"button\" class=\"fill\">Logout</button>`\n\t\t\t\t\t: this._defaultHTML;\n\t\t\t}\n\t\t);\n\n\t\tthis.addEventListener(\"click\", (e: MouseEvent) => this.onClick(e), false);\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis._store.isMastodonAuthorized$.unsubscribe(this._subscription);\n\t\tthis.removeEventListener(\n\t\t\t\"click\",\n\t\t\t(e: MouseEvent) => this.onClick(e),\n\t\t\tfalse\n\t\t);\n\t}\n}\n","import store from \"../../state/index\";\n\ninterface Filter {\n\tkey: string;\n\tvalue: string;\n\tcomparator: \"eq\" | \"gt\";\n}\n\nexport class ChaosFilter extends HTMLElement {\n\tprivate originalFields: HTMLElement[];\n\n\t// the form that gets placed into the chaos-filter-form slot\n\tprivate get formElement(): HTMLFormElement {\n\t\treturn this.querySelector(\"[slot='chaos-filter-form']\") as HTMLFormElement;\n\t}\n\n\t// all selectors in the form. Other input types not supported.\n\tprivate get selectors(): HTMLSelectElement[] {\n\t\treturn Array.from(\n\t\t\tthis.formElement.querySelectorAll(\"select\")\n\t\t) as HTMLSelectElement[];\n\t}\n\n\t// a key-value set of all the possible filter matches and the user's current selection.\n\t// if the filter is set to \"all\", it will not be added to the filter list.\n\t// e.g. { key: 'folder', value: 'faith' }\n\tprivate get filters(): Filter[] {\n\t\treturn this.selectors\n\t\t\t.map((x) => {\n\t\t\t\treturn <Filter>{\n\t\t\t\t\tkey: x.dataset.match,\n\t\t\t\t\tvalue: x.options[x.selectedIndex].value,\n\t\t\t\t\tcomparator: x.dataset.comparator ?? \"eq\",\n\t\t\t\t};\n\t\t\t})\n\t\t\t.filter((x) => x.value !== \"all\");\n\t}\n\n\t// the first unordered list inside the chaos-filter-fields slot content, if\n\t// the slot isn't already an unordered list\n\tprivate get fieldsElement(): HTMLUListElement {\n\t\tconst slot = this.querySelector(\n\t\t\t\"[slot='chaos-filter-fields']\"\n\t\t) as HTMLElement;\n\n\t\treturn slot.tagName === \"UL\"\n\t\t\t? (slot as HTMLUListElement)\n\t\t\t: (slot.querySelector(\"ul\") as HTMLUListElement);\n\t}\n\n\t// all of the fields available for sort\n\tprivate get fieldList(): HTMLLIElement[] {\n\t\treturn Array.from(this.fieldsElement.children) as HTMLLIElement[];\n\t}\n\n\t// apply the filter against the original field list. Replace the children\n\t// in the DOM and notify that the field filter has changed.\n\t// the notice is used by the chaos-resizer to dictate a new widest field\n\t// and minimum width\n\tfilterFields() {\n\t\tconst filteredFields = this.originalFields.filter((field) =>\n\t\t\tthis.filters.every((x) => {\n\t\t\t\tif (x.comparator === \"eq\") return field.dataset[x.key] === x.value;\n\t\t\t\tif (x.comparator === \"gt\")\n\t\t\t\t\treturn Number(field.dataset[x.key]) > Number(x.value);\n\t\t\t\treturn false;\n\t\t\t})\n\t\t);\n\n\t\tthis.fieldsElement.replaceChildren(...filteredFields);\n\t\tstore.onFieldFilter$.notify();\n\t}\n\n\t// updates the query string without reloading the page so my query\n\t// state persists with links\n\tupdateParams() {\n\t\tconst params = new URLSearchParams();\n\t\tthis.filters.forEach((x) => params.set(x.key, x.value));\n\n\t\t// only adds query params if any exist\n\t\tconst newUrl =\n\t\t\tArray.from(params.entries()).length > 0\n\t\t\t\t? `${window.location.origin}${\n\t\t\t\t\t\twindow.location.pathname\n\t\t\t\t  }?${params.toString()}`\n\t\t\t\t: `${window.location.origin}${window.location.pathname}`;\n\n\t\twindow.history.pushState({ path: newUrl }, \"\", newUrl);\n\t}\n\n\t// retrieve the current query params and update my select options\n\t// to point to what's been set in the URL.\n\tsetFiltersFromParams() {\n\t\tconst params = new URLSearchParams(window.location.search);\n\t\tthis.selectors\n\t\t\t.filter((x) => params.has(x.dataset.match))\n\t\t\t.forEach((select) => {\n\t\t\t\tconst match = params.get(select.dataset.match);\n\t\t\t\tconst options = Array.from(select.options) as HTMLOptionElement[];\n\t\t\t\tselect.selectedIndex = options.findIndex((x) => x.value === match);\n\t\t\t});\n\t}\n\n\tonSubmit(e: SubmitEvent) {\n\t\te.preventDefault();\n\t\tthis.filterFields();\n\t\tthis.updateParams();\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tconst buildTemplate = () => {\n\t\t\tconst t = document.createElement(\"template\");\n\t\t\tt.innerHTML = `\n\t\t\t<slot name=\"chaos-filter-form\"></slot>\n\t\t\t<slot name=\"chaos-filter-fields\"></slot>\n\t\t\t`;\n\t\t\treturn t.content;\n\t\t};\n\n\t\tthis.attachShadow({ mode: \"open\" }).appendChild(\n\t\t\tbuildTemplate().cloneNode(true)\n\t\t);\n\n\t\t// stores the original fields for easy filter generation\n\t\tthis.originalFields = this.fieldList;\n\n\t\tthis.setFiltersFromParams();\n\t\tthis.filterFields();\n\t}\n\n\tconnectedCallback() {\n\t\tthis.addEventListener(\n\t\t\t\"submit\",\n\t\t\t(e: SubmitEvent) => this.onSubmit(e),\n\t\t\tfalse\n\t\t);\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.removeEventListener(\n\t\t\t\"submit\",\n\t\t\t(e: SubmitEvent) => this.onSubmit(e),\n\t\t\tfalse\n\t\t);\n\t}\n}\n","import store from \"../../state/index\";\n\n// resizes a list where each list item has two children\nexport class ChaosResizer extends HTMLElement {\n\tprivate resizer: ResizeObserver;\n\tprivate widestField: HTMLElement;\n\tprivate minimumWidth: number;\n\tprivate _subscription: string;\n\n\tprivate get fieldList(): HTMLUListElement {\n\t\treturn this.querySelector(\"ul\") as HTMLUListElement;\n\t}\n\n\tprivate get fields(): HTMLLIElement[] {\n\t\treturn Array.from(this.fieldList.querySelectorAll(\"li\")) as HTMLLIElement[];\n\t}\n\n\t// sets the widest field and minimum width state\n\tprivate setFieldAndWidth() {\n\t\tconst widestField = [...this.fields]\n\t\t\t.map((x) => {\n\t\t\t\tconst itemPair = Array.from(x.children);\n\t\t\t\treturn { parent: x, attr: itemPair[0], title: itemPair[1] };\n\t\t\t})\n\t\t\t.sort((a, b) => a.title.scrollWidth - b.title.scrollWidth)\n\t\t\t.pop();\n\n\t\tthis.minimumWidth =\n\t\t\twidestField.attr.scrollWidth + widestField.title.scrollWidth;\n\n\t\tthis.widestField = widestField.parent;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.setFieldAndWidth();\n\n\t\t// swaps the class on the parent ul element when the widest child\n\t\t// gets too big to render on one line. Wide uses flex-direction: row while\n\t\t// narrow uses flex-direction: columnn. Fires on every resize.\n\t\tthis.resizer = new ResizeObserver((entries) => {\n\t\t\tfor (const entry of entries) {\n\t\t\t\tconst parentWidth = entry.contentBoxSize[0].inlineSize;\n\t\t\t\tconst tooSmall = parentWidth <= this.minimumWidth;\n\n\t\t\t\tif (tooSmall && this.fieldList.classList.contains(\"filter-wide\")) {\n\t\t\t\t\tthis.fieldList.classList.remove(\"filter-wide\");\n\t\t\t\t\tthis.fieldList.classList.add(\"filter-narrow\");\n\t\t\t\t}\n\t\t\t\tif (!tooSmall && this.fieldList.classList.contains(\"filter-narrow\")) {\n\t\t\t\t\tthis.fieldList.classList.remove(\"filter-narrow\");\n\t\t\t\t\tthis.fieldList.classList.add(\"filter-wide\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tconnectedCallback() {\n\t\t// subscribes to changes in the field list. Currently changes when the filter\n\t\t// adjusts the field list items. Toggles the observable fields to avoid\n\t\t// watching a list item that's dropped to zero width.\n\t\tthis._subscription = store.onFieldFilter$.subscribe(\"chaos-resizer\", () => {\n\t\t\tthis.resizer.unobserve(this.widestField);\n\t\t\tthis.setFieldAndWidth();\n\t\t\tthis.resizer.observe(this.widestField);\n\t\t});\n\t\tthis.resizer.observe(this.widestField);\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.resizer.unobserve(this.widestField);\n\t\tstore.onFieldFilter$.unsubscribe(this._subscription);\n\t}\n}\n","export class ChaosOnThisDay extends HTMLElement {\n\tvisible: boolean;\n\ttemplate: HTMLElement;\n\tarticles: HTMLElement[];\n\n\tget logFeedUrl(): URL {\n\t\treturn new URL(\n\t\t\twindow.location.origin + window.location.pathname + \"index.xml\"\n\t\t);\n\t}\n\n\tget container(): HTMLElement {\n\t\treturn this.querySelector(\"#on-this-day\");\n\t}\n\n\tget button(): HTMLButtonElement {\n\t\treturn this.querySelector(\"button\");\n\t}\n\n\thide() {\n\t\tthis.articles.forEach((x) => this.container.removeChild(x));\n\t\tthis.visible = false;\n\t\tthis.container.hidden = true;\n\t\tthis.button.innerText = \"Show On This Day\";\n\t}\n\n\tshow(articles: HTMLElement[]) {\n\t\tarticles.forEach((x) => this.container.appendChild(x));\n\t\tthis.visible = true;\n\t\tthis.container.hidden = false;\n\t\tthis.button.innerText = \"Hide On This Day\";\n\t}\n\n\tcloneArticle(item: any): HTMLElement {\n\t\tconst query = (s) => item.querySelector(s).firstChild.data;\n\t\tconst toDate = (s) => new Date(query(s)).toISOString().substr(0, 10);\n\n\t\tconst template = <HTMLElement>(\n\t\t\tdocument.querySelector(\"article\").cloneNode(true)\n\t\t);\n\t\t// centers the new log instead\n\t\ttemplate.classList.remove(\"wrapper-no-center\");\n\n\t\tconst attr = <HTMLUListElement>template.querySelector(\"ul\");\n\t\t(<HTMLTimeElement>attr.querySelector(\"time\")).innerText = toDate(\"pubDate\");\n\t\t(<HTMLAnchorElement>attr.querySelector(\"[rel='author']\")).innerText =\n\t\t\tquery(\"author\");\n\t\t(<HTMLAnchorElement>attr.querySelector(\"[rel='bookmark']\")).href =\n\t\t\tquery(\"link\");\n\n\t\t// removes all children except the attr list\n\t\tArray.from(template.children).forEach((el) => {\n\t\t\tif (el != attr) template.removeChild(el);\n\t\t});\n\n\t\t// appends new content\n\t\ttemplate.innerHTML += query(\"description\");\n\n\t\treturn template;\n\t}\n\n\tgetPreviousLogs(): Promise<HTMLElement[]> {\n\t\tconst parser = new DOMParser();\n\t\tconst today = new Date();\n\n\t\tconst failedParse = (xml) =>\n\t\t\txml.getElementsByTagName(\"parsererror\")?.length !== 0;\n\n\t\tconst fromPreviousYear = (a: Date, b: Date) =>\n\t\t\ta.getFullYear() !== b.getFullYear() &&\n\t\t\ta.getMonth() === b.getMonth() &&\n\t\t\ta.getDate() === b.getDate();\n\n\t\tconst noLogs = document.createElement(\"p\");\n\t\tnoLogs.innerText = `No previous logs on this date (${\n\t\t\ttoday.getMonth() + 1\n\t\t}/${today.getDate()})`;\n\t\tnoLogs.classList.add(\"wrapper\");\n\n\t\treturn fetch(this.logFeedUrl)\n\t\t\t.then((x) => x.text())\n\t\t\t.then((x) => parser.parseFromString(x, \"text/xml\"))\n\t\t\t.then((logsXml: XMLDocument) => {\n\t\t\t\tif (failedParse(logsXml)) {\n\t\t\t\t\tconsole.log(`Failed to load XML from ${this.logFeedUrl}`);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst articles = Array.from(logsXml.getElementsByTagName(\"pubDate\"))\n\t\t\t\t\t.filter((el) => fromPreviousYear(today, new Date(el.innerHTML)))\n\t\t\t\t\t.map((el) => this.cloneArticle(el.parentNode));\n\n\t\t\t\treturn articles.length > 0 ? articles : [noLogs];\n\t\t\t});\n\t}\n\n\tasync onClick(e: MouseEvent) {\n\t\te.preventDefault();\n\t\tif (this.visible) {\n\t\t\tthis.hide();\n\t\t} else {\n\t\t\tif (!this.articles) {\n\t\t\t\tthis.getPreviousLogs().then((articles) => {\n\t\t\t\t\tthis.articles = articles;\n\t\t\t\t\tthis.show(articles);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.show(this.articles);\n\t\t\t}\n\t\t}\n\t}\n\n\trender() {\n\t\tthis.innerHTML = `\n\t\t\t<aside>\n\t\t\t\t<button type=\"button\">Show On This Day</button>\n\t\t\t\t<div id=\"on-this-day\" class=\"wrapper no-h-padding | flow-m previous-cards\" hidden>\n\t\t\t\t</div>\n\t\t\t</aside>\n\t\t`;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tconnectedCallback() {\n\t\tthis.render();\n\t\tthis.addEventListener(\"click\", (e: MouseEvent) => this.onClick(e), false);\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.removeEventListener(\n\t\t\t\"click\",\n\t\t\t(e: MouseEvent) => this.onClick(e),\n\t\t\tfalse\n\t\t);\n\t}\n}\n","export class ChaosColorSwitch extends HTMLElement {\n\tprivate themes = {\n\t\tMinimal: \"minimal\",\n\t\tJungle: \"jungle\",\n\t\tFall: \"fall\",\n\t\tVoid: \"void\",\n\t};\n\n\tget theme(): string {\n\t\treturn localStorage.getItem(\"theme\") || this.themes[\"minimal\"];\n\t}\n\n\tset theme(val: string) {\n\t\tlocalStorage.setItem(\"theme\", val);\n\t\tdocument.documentElement.setAttribute(\"theme\", val);\n\t}\n\n\tget themeSelector(): HTMLSelectElement {\n\t\treturn this.querySelector(\"select\") as HTMLSelectElement;\n\t}\n\n\tget themeOptions(): HTMLOptionElement[] {\n\t\treturn Array.from(this.themeSelector.options) as HTMLOptionElement[];\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tonThemeChange(e: InputEvent) {\n\t\tconst select = e.target as HTMLSelectElement;\n\t\tthis.theme = select.options[select.selectedIndex].value;\n\t}\n\n\trender() {\n\t\tconst options = Object.entries(this.themes).map(\n\t\t\t([k, v]) => `<option value=${v}>${k}</option>`\n\t\t);\n\n\t\tthis.innerHTML = `\n\t\t<select>\n\t\t\t${options}\n\t\t</select>\n\t\t`;\n\t}\n\n\tconnectedCallback() {\n\t\tthis.render();\n\t\tthis.addEventListener(\n\t\t\t\"change\",\n\t\t\t(e: InputEvent) => this.onThemeChange(e),\n\t\t\tfalse\n\t\t);\n\n\t\t// sets the selector to initial attribute value\n\t\tthis.themeSelector.selectedIndex = this.themeOptions.findIndex(\n\t\t\t(x) => x.value === this.theme\n\t\t);\n\n\t\t// sets global value for when it's only in local storage\n\t\tdocument.documentElement.setAttribute(\"theme\", this.theme);\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis.removeEventListener(\n\t\t\t\"change\",\n\t\t\t(e: InputEvent) => this.onThemeChange(e),\n\t\t\tfalse\n\t\t);\n\t}\n}\n","import { ChaosPanelOption } from \"./chaos-panel-option\";\nimport {\n\tResponse,\n\tChangeRequest,\n\tChangeOption,\n\tPanelStatus,\n\tPanelType,\n} from \"../../services/models\";\nimport {\n\tmapClass,\n\tgetSimpleDate,\n\tgetFilePathByDate,\n} from \"../../shared/operators\";\nimport { PublishService } from \"../../services/publish-service/publish-service\";\nimport { Store } from \"../../state/store\";\nimport {\n\tInjectionRequest,\n\tInstances,\n\tbuildRequest,\n} from \"../../state/injector\";\n\nexport class ChaosPanel extends HTMLElement {\n\tprivate _pub: PublishService;\n\tprivate _store: Store;\n\tprivate _subscriptions = {\n\t\tauth: null,\n\t\tmastodon: null,\n\t};\n\tprivate _typesWithOptions = [PanelType.PLANT, PanelType.STONE];\n\tprivate _initialMarkup;\n\t_isNew = true;\n\n\tget isNew(): boolean {\n\t\treturn this._isNew;\n\t}\n\n\tset isNew(v: boolean) {\n\t\tthis._isNew = v;\n\t\tconst editBtn = this.getButton(PanelStatus.EDITING);\n\t\tconst createBtn = this.getButton(PanelStatus.CREATING);\n\t\tif (v) {\n\t\t\teditBtn.classList.remove(\"selected-panel-type\");\n\t\t\tcreateBtn.classList.add(\"selected-panel-type\");\n\t\t} else {\n\t\t\teditBtn.classList.add(\"selected-panel-type\");\n\t\t\tcreateBtn.classList.remove(\"selected-panel-type\");\n\t\t}\n\t}\n\n\tget panelType(): PanelType {\n\t\treturn <PanelType>this.getAttribute(\"data-panel-type\");\n\t}\n\n\tgetButton(status: PanelStatus) {\n\t\treturn <HTMLButtonElement>this.querySelector(`button#${status}`);\n\t}\n\n\tgetCharacterCount(): HTMLElement {\n\t\treturn <HTMLElement>this.querySelector(\"#character-count\");\n\t}\n\n\tget panelOptions(): ChaosPanelOption[] {\n\t\treturn <ChaosPanelOption[]>(\n\t\t\tArray.from(this.querySelectorAll(\"chaos-panel-option\") || [])\n\t\t);\n\t}\n\n\tget syndicateOption(): ChaosPanelOption {\n\t\treturn this.panelOptions.find((x) => x.key === \"syndicate\");\n\t}\n\n\tget contents(): string {\n\t\treturn (<HTMLTextAreaElement>this.querySelector(\"textarea\"))?.value || \"\";\n\t}\n\n\tset contents(v: string) {\n\t\t(<HTMLTextAreaElement>this.querySelector(\"textarea\")).innerText = v;\n\t}\n\n\tget errorMsg(): string {\n\t\treturn (<HTMLElement>this.querySelector(\"#error-message\"))?.innerText || \"\";\n\t}\n\n\tset errorMsg(v: string) {\n\t\t(<HTMLElement>this.querySelector(\"#error-message\")).innerText = v;\n\t}\n\n\tget frontmatter(): object {\n\t\treturn this.panelOptions.length === 0\n\t\t\t? {}\n\t\t\t: this.panelOptions.reduce((prev, curr) => {\n\t\t\t\t\tconst m = curr.getModel();\n\t\t\t\t\tif (m?.key && m?.value) {\n\t\t\t\t\t\tprev[m.key] = m.value;\n\t\t\t\t\t}\n\t\t\t\t\treturn prev;\n\t\t\t  }, {});\n\t}\n\n\tprivate get filePath(): string {\n\t\treturn document.location.pathname;\n\t}\n\n\tprivate get shouldHaveOptions(): boolean {\n\t\treturn this._typesWithOptions.includes(this.panelType);\n\t}\n\n\tupdateChaosPanelOptions(path: string, frontmatter: object) {\n\t\tconst options = this.panelOptions;\n\t\tconst optionByAttr = (a) =>\n\t\t\toptions.find((x) => x.getAttribute(\"data-key\") === a);\n\n\t\t// update path\n\t\tconst pathOption = optionByAttr(\"path\");\n\t\tif (pathOption) {\n\t\t\tpathOption.value = path;\n\t\t\tpathOption.readonly = true;\n\t\t}\n\n\t\t// update front matter options\n\t\tObject.keys(frontmatter).forEach((k) => {\n\t\t\tconst o = optionByAttr(k);\n\t\t\tif (o) {\n\t\t\t\to.value = frontmatter[k];\n\t\t\t}\n\t\t});\n\t}\n\n\tclearChaosPanelOptions() {\n\t\tconst options = this.panelOptions;\n\t\toptions.forEach((o) => (o.value = null));\n\t}\n\n\tstartUpdate() {\n\t\treturn this._pub.read(this._store.token, this.filePath).then((r) => {\n\t\t\tif (r.success) {\n\t\t\t\tthis.contents = r.content.body;\n\t\t\t\tthis.updateChaosPanelOptions(r.content.path, r.content.frontmatter);\n\t\t\t\tthis.isNew = false;\n\t\t\t} else {\n\t\t\t\tthis.errorMsg = r.message;\n\t\t\t}\n\t\t});\n\t}\n\n\tstartCreate() {\n\t\tthis.contents = \"\";\n\t\tthis.clearChaosPanelOptions();\n\t\tthis.isNew = true;\n\t}\n\n\tupdateFile() {\n\t\tconst frontmatter = this.frontmatter;\n\n\t\t// sets the path based on type\n\t\tlet path: string;\n\t\tif (\"path\" in frontmatter) {\n\t\t\tpath = frontmatter[\"path\"];\n\t\t\tdelete frontmatter[\"path\"];\n\t\t} else {\n\t\t\tif (!this.shouldHaveOptions) path = this.getFilePath();\n\t\t}\n\n\t\tfrontmatter[\"lastmod\"] = new Date().toISOString();\n\n\t\treturn this._pub\n\t\t\t.update(this._store.token, <ChangeRequest>{\n\t\t\t\tbody: this.contents,\n\t\t\t\ttoken: this._store.mastodonToken,\n\t\t\t\tpath,\n\t\t\t\tfrontmatter,\n\t\t\t})\n\t\t\t.then(\n\t\t\t\t(r) => {\n\t\t\t\t\tif (r.success) {\n\t\t\t\t\t\tthis.contents = r.content.body;\n\t\t\t\t\t\tthis.errorMsg = \"success\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.errorMsg = r.message;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t(e) => (this.errorMsg = e.toString())\n\t\t\t);\n\t}\n\n\tgetFilePath(): string {\n\t\tswitch (this.panelType) {\n\t\t\tcase PanelType.PLANT:\n\t\t\tcase PanelType.STONE:\n\t\t\tdefault:\n\t\t\t\treturn this.filePath;\n\t\t\tcase PanelType.QUIP:\n\t\t\tcase PanelType.LOG:\n\t\t\t\treturn getFilePathByDate(this.panelType);\n\t\t}\n\t}\n\n\tcreateFile() {\n\t\tconst frontmatter = this.frontmatter;\n\n\t\t// sets the path based on type\n\t\tlet path: string;\n\t\tif (\"path\" in frontmatter && this.shouldHaveOptions) {\n\t\t\tpath = frontmatter[\"path\"];\n\t\t\tdelete frontmatter[\"path\"];\n\t\t} else {\n\t\t\tpath = this.getFilePath();\n\t\t}\n\n\t\tconst now = new Date();\n\t\tfrontmatter[\"date\"] = getSimpleDate(now);\n\t\tfrontmatter[\"lastmod\"] = now.toISOString();\n\n\t\tthis._pub\n\t\t\t.create(this._store.token, <ChangeRequest>{\n\t\t\t\tbody: this.contents,\n\t\t\t\ttoken: this._store.mastodonToken,\n\t\t\t\tfrontmatter,\n\t\t\t\tpath,\n\t\t\t})\n\t\t\t.then(\n\t\t\t\t(r) => {\n\t\t\t\t\tif (r.success) {\n\t\t\t\t\t\tthis.contents = r.content.body;\n\t\t\t\t\t\tthis.updateChaosPanelOptions(r.content.path, r.content.frontmatter);\n\t\t\t\t\t\tthis.errorMsg = r.message;\n\t\t\t\t\t}\n\t\t\t\t\tthis.errorMsg = r.message;\n\t\t\t\t},\n\t\t\t\t(e) => (this.errorMsg = e.toString())\n\t\t\t);\n\t}\n\n\tvalidate(): boolean {\n\t\tconst options = this.panelOptions.map((x) => x.getModel());\n\t\tconst missingRequiredValues = options\n\t\t\t.filter((x) => x.required)\n\t\t\t.some((x) => !x.value);\n\n\t\tif (this.shouldHaveOptions && missingRequiredValues) {\n\t\t\tthis.errorMsg = \"Not all required fields have values\";\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\trender() {\n\t\tconst panelButtons = Object.keys(PanelStatus)\n\t\t\t.map((k) => {\n\t\t\t\treturn `<button id=\"${PanelStatus[k]}\"\n\t\t\t\t${PanelStatus[k] == PanelStatus.SAVING ? 'type=\"submit\" disabled' : \"\"}\n\t\t\t\t>${PanelStatus[k]}</button>`;\n\t\t\t})\n\t\t\t.join(\"\");\n\n\t\treturn `\n\t\t\t<form class=\"wrapper\">\n\t\t\t\t<fieldset id=\"panel-buttons\">\n\t\t\t\t\t${panelButtons}\n\t\t\t\t</fieldset>\n\t\t\t\t<fieldset>${this._initialMarkup}</fieldset>\n\t\t\t\t<div>\n\t\t\t\t\t<p><span id=\"character-count\">0</span> characters</p>\n\t\t\t\t\t<p id=\"error-message\"></p>\n\t\t\t\t</div>\n\t\t\t\t<textarea>${this.contents}</textarea>\n\t\t\t</form>\n\t\t`;\n\t}\n\n\tonButtonClick(e: SubmitEvent) {\n\t\te.preventDefault();\n\t\tconst btn = <HTMLButtonElement>e.submitter;\n\t\tconst status = btn.id as PanelStatus;\n\t\tswitch (status) {\n\t\t\tcase PanelStatus.CREATING:\n\t\t\t\tthis.startCreate();\n\t\t\t\tbreak;\n\t\t\tcase PanelStatus.EDITING:\n\t\t\t\tthis.startUpdate();\n\t\t\t\tbreak;\n\t\t\tcase PanelStatus.SAVING:\n\t\t\t\tif (this.validate()) {\n\t\t\t\t\tif (this.isNew) {\n\t\t\t\t\t\tthis.createFile();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.updateFile();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.errorMsg = `selected an unknown button status`;\n\t\t}\n\t}\n\n\tonKeyUp(e: KeyboardEvent) {\n\t\te.preventDefault();\n\t\tconst el = <HTMLTextAreaElement>e.target;\n\t\tthis.getButton(PanelStatus.SAVING).disabled = el.value.length <= 0;\n\t\tthis.getCharacterCount().innerText = el.value.length.toString();\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._initialMarkup = this.innerHTML;\n\t\tthis.innerHTML = \"\";\n\t}\n\n\tconnectedCallback() {\n\t\tconst getPublish = buildRequest(<InjectionRequest>{\n\t\t\tinstance: Instances.PUBLISH,\n\t\t\tcallback: (e) => (this._pub = e),\n\t\t});\n\n\t\tconst getStore = buildRequest(<InjectionRequest>{\n\t\t\tinstance: Instances.STORE,\n\t\t\tcallback: (e) => (this._store = e),\n\t\t});\n\n\t\tthis.dispatchEvent(getPublish);\n\t\tthis.dispatchEvent(getStore);\n\n\t\tthis._subscriptions.auth = this._store.isAuthorized$.subscribe(\n\t\t\t\"chaos-panel\",\n\t\t\t(isAuth) => {\n\t\t\t\tif (isAuth) {\n\t\t\t\t\tthis.innerHTML = this.render();\n\t\t\t\t} else {\n\t\t\t\t\tthis.innerHTML = `<span hidden>Not authorized to view panel</span>`;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\t// if syndication is an available option, make it readonly if\n\t\t// I don't currently have authorization\n\t\tif (this.syndicateOption) {\n\t\t\tthis._subscriptions.mastodon =\n\t\t\t\tthis._store.isMastodonAuthorized$.subscribe(\n\t\t\t\t\t\"chaos-panel\",\n\t\t\t\t\t(isAuth) => (this.syndicateOption.readonly = !isAuth)\n\t\t\t\t);\n\t\t}\n\n\t\tthis.addEventListener(\"submit\", (e) => this.onButtonClick(e));\n\t\tthis.addEventListener(\"keyup\", (e) => this.onKeyUp(e));\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis._store.isAuthorized$.unsubscribe(this._subscriptions.auth);\n\t\tthis._store.isMastodonAuthorized$.unsubscribe(this._subscriptions.mastodon);\n\t\tthis.removeEventListener(\"submit\", (e) => this.onButtonClick(e));\n\t\tthis.removeEventListener(\"keyup\", (e) => this.onKeyUp(e));\n\t}\n}\n","import { Store } from \"../../state/store\";\nimport {\n\tInjectionRequest,\n\tInstances,\n\tbuildRequest,\n} from \"../../state/injector\";\nimport {\n\tChangeOption,\n\tPanelOptionType,\n\tSupportedPanelTypes,\n} from \"../../services/models\";\n\nexport class ChaosPanelOption extends HTMLElement {\n\tprivate _store: Store;\n\tprivate _subscription: string;\n\n\tget key(): string {\n\t\treturn this.getAttribute(\"data-key\");\n\t}\n\n\tget label(): string {\n\t\treturn this.getAttribute(\"data-label\");\n\t}\n\n\tget input(): HTMLInputElement {\n\t\treturn <HTMLInputElement>this.querySelector(\"input\");\n\t}\n\n\tget value(): SupportedPanelTypes {\n\t\tconst value = this.getAttribute(\"data-value\") || \"\";\n\n\t\tswitch (this.type) {\n\t\t\tcase PanelOptionType.TEXT:\n\t\t\tdefault:\n\t\t\t\treturn value;\n\t\t\tcase PanelOptionType.LIST:\n\t\t\t\treturn value.includes(\",\")\n\t\t\t\t\t? value.replaceAll(\" \", \"\").split(\",\")\n\t\t\t\t\t: [value.trim()];\n\t\t\tcase PanelOptionType.BOOLEAN:\n\t\t\t\treturn [\"true\", \"yes\"].includes(value.toLowerCase());\n\t\t}\n\t}\n\n\tset value(v: SupportedPanelTypes) {\n\t\tthis.setAttribute(\"data-value\", String(v));\n\t\tthis.input.value = String(v);\n\t}\n\n\tget required(): boolean {\n\t\treturn !!this.getAttribute(\"data-required\");\n\t}\n\n\tget readonly(): boolean {\n\t\treturn !!this.getAttribute(\"data-readonly\");\n\t}\n\n\tset readonly(v: boolean) {\n\t\tthis.setAttribute(\"data-readonly\", String(v));\n\t\tthis.input.readOnly = v;\n\t}\n\n\tget type(): PanelOptionType {\n\t\tconst type = this.getAttribute(\"data-type\");\n\t\treturn type ? PanelOptionType[type.toUpperCase()] : PanelOptionType.TEXT;\n\t}\n\n\tgetModel(): ChangeOption {\n\t\treturn <ChangeOption>{\n\t\t\tkey: this.key,\n\t\t\tname: this.label,\n\t\t\tvalue: this.value,\n\t\t\trequired: this.required,\n\t\t\ttype: this.type,\n\t\t};\n\t}\n\n\tonEdit(e) {\n\t\te.preventDefault();\n\t\tthis.value = e.target.value;\n\t}\n\n\trender() {\n\t\treturn `\n\t\t\t<li class=\"panel-option spread-btwn${this.required ? \" required\" : \"\"}\">\n\t\t\t\t<label for=\"${this.label}\">${this.label}</label>\n\t\t\t\t<span>${this.required ? \"(required)\" : \"\"}\n\t\t\t\t<input\n\t\t\t\t\t${this.label ? `name=\"${this.label}\"` : \"\"}\n\t\t\t\t\t${this.value ? `value=\"${this.value}\"` : \"\"}\n\t\t\t\t\t${this.readonly ? \"disabled\" : \"\"}\n\t\t\t\t/></span>\n\t\t\t</li>\n\t\t`;\n\t}\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tconnectedCallback() {\n\t\tconst getStore = buildRequest(<InjectionRequest>{\n\t\t\tinstance: Instances.STORE,\n\t\t\tcallback: (e) => (this._store = e),\n\t\t});\n\n\t\tthis.dispatchEvent(getStore);\n\n\t\tthis._subscription = this._store.isAuthorized$.subscribe(\n\t\t\t\"chaos-panel-option\",\n\t\t\t(isAuth) => {\n\t\t\t\tif (isAuth) {\n\t\t\t\t\tthis.innerHTML = this.render();\n\t\t\t\t} else {\n\t\t\t\t\tthis.innerHTML = `<span hidden>Not authorized to view panel option</span>`;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\tthis.addEventListener(\"keyup\", (e) => this.onEdit(e));\n\t}\n\n\tdisconnectedCallback() {\n\t\tthis._store.isAuthorized$.unsubscribe(this._subscription);\n\t\tthis.removeEventListener(\"keyup\", (e) => this.onEdit(e));\n\t}\n}\n","import { ChaosLogin } from \"./components/login/chaos-login\";\nimport { ChaosLogout } from \"./components/logout/chaos-logout\";\nimport { ChaosMastoLogin } from \"./components/login/chaos-masto-login\";\nimport { ChaosMastoLogout } from \"./components/logout/chaos-masto-logout\";\nimport { ChaosFilter } from \"./components/filter/chaos-filter\";\nimport { ChaosResizer } from \"./components/resizer/chaos-resizer\";\nimport { ChaosOnThisDay } from \"./components/on-this-day/chaos-on-this-day\";\nimport { ChaosColorSwitch } from \"./components/color-switch/chaos-color-switch\";\nimport { ChaosPanel } from \"./components/file/chaos-panel\";\nimport { ChaosPanelOption } from \"./components/file/chaos-panel-option\";\nimport { InjectorMap, InjectionRequest, Instances } from \"./state/injector\";\n\n// poor man's dependency injection. Singleton objects are instantiated\n// at runtime into the InjectorMap without reflection.\n// Must be created prior to custom elements because they emit events\n// to retrieve their dependencies from the injector\ndocument.addEventListener(\"chaos-request\", (e: CustomEvent) => {\n\tconst request = <InjectionRequest>e.detail;\n\tconst instance = InjectorMap.get(request.instance);\n\trequest.callback(instance);\n});\n\ncustomElements.define(\"chaos-login\", ChaosLogin);\ncustomElements.define(\"chaos-logout\", ChaosLogout);\ncustomElements.define(\"chaos-masto-login\", ChaosMastoLogin);\ncustomElements.define(\"chaos-masto-logout\", ChaosMastoLogout);\ncustomElements.define(\"chaos-filter\", ChaosFilter);\ncustomElements.define(\"chaos-resizer\", ChaosResizer);\ncustomElements.define(\"chaos-on-this-day\", ChaosOnThisDay);\ncustomElements.define(\"chaos-color-switch\", ChaosColorSwitch);\ncustomElements.define(\"chaos-panel\", ChaosPanel);\ncustomElements.define(\"chaos-panel-option\", ChaosPanelOption);\n"],"names":["PanelStatus","PanelOptionType","PanelType","getUrlFromHead","rel","Array","from","document","head","children","find","x","href","authorized","token","baseUri","Promise","resolve","reject","headers","Headers","append","fetch","URL","then","r","status","sessionStorage","setItem","err","Notified","_subscribers","Map","subscribe","subscriber","callback","sub","Math","random","this","set","unsubscribe","notify","forEach","Observed","value","_value","v","constructor","super","Instances","store","Store","getItem","mastodonToken","isAuthorized$","isMastodonAuthorized$","onFieldFilter$","isAuth","window","addEventListener","ev","isTrusted","data","location","code","redirect","json","mastodonAuthorized","params","URLSearchParams","search","has","opener","postMessage","get","origin","close","InjectorMap","PUBLISH","PublishService","create","payload","success","message","method","body","JSON","stringify","b","read","filePath","update","AUTH","authenticate","username","password","btoa","isAuthorized","unauthenticate","removeItem","MASTOAUTH","authenticationUri","open","mastotoken","STORE","buildRequest","request","CustomEvent","bubbles","composed","detail","ChaosLogin","HTMLElement","querySelector","errors","onClick","e","_this$username","_this$password","target","type","preventDefault","stopPropagation","_auth","msg","innerText","render","innerHTML","connectedCallback","dispatchEvent","instance","disconnectedCallback","removeEventListener","ChaosLogout","_store","_subscription","getAuth","getStore","ChaosMastoLogin","_mastoauth","redirectUri","_defaultHTML","ChaosMastoLogout","ChaosFilter","formElement","selectors","querySelectorAll","map","_x$dataset$comparator","key","dataset","match","options","selectedIndex","comparator","filter","fieldsElement","slot","tagName","fieldList","filterFields","filteredFields","originalFields","field","filters","every","Number","replaceChildren","updateParams","entries","length","pathname","toString","history","pushState","path","newUrl","setFiltersFromParams","select","findIndex","onSubmit","attachShadow","mode","appendChild","t","createElement","content","buildTemplate","cloneNode","ChaosResizer","fields","setFieldAndWidth","widestField","itemPair","parent","attr","title","sort","a","scrollWidth","pop","minimumWidth","resizer","ResizeObserver","entry","tooSmall","contentBoxSize","inlineSize","classList","contains","remove","add","unobserve","observe","ChaosOnThisDay","logFeedUrl","button","hide","articles","container","removeChild","visible","hidden","show","cloneArticle","item","query","s","firstChild","template","toISOString","substr","el","getPreviousLogs","parser","DOMParser","today","Date","noLogs","getMonth","getDate","text","parseFromString","logsXml","_xml$getElementsByTag","getElementsByTagName","console","log","xml","fromPreviousYear","getFullYear","parentNode","async","ChaosColorSwitch","theme","localStorage","themes","val","documentElement","setAttribute","themeSelector","Minimal","Jungle","Fall","Void","onThemeChange","Object","k","themeOptions","ChaosPanel","_isNew","isNew","editBtn","getButton","EDITING","createBtn","CREATING","panelType","getAttribute","getCharacterCount","syndicateOption","panelOptions","contents","_this$querySelector","errorMsg","_this$querySelector2","frontmatter","reduce","prev","curr","m","getModel","shouldHaveOptions","_typesWithOptions","includes","updateChaosPanelOptions","optionByAttr","pathOption","readonly","keys","o","clearChaosPanelOptions","startUpdate","_pub","startCreate","updateFile","getFilePath","PLANT","STONE","QUIP","LOG","prependZero","now","y","d","h","getHours","mi","getMinutes","getSeconds","getFilePathByDate","createFile","getSimpleDate","join","validate","missingRequiredValues","required","some","SAVING","_initialMarkup","onButtonClick","submitter","id","onKeyUp","disabled","_subscriptions","auth","mastodon","getPublish","label","TEXT","LIST","replaceAll","split","trim","BOOLEAN","toLowerCase","String","input","readOnly","toUpperCase","name","onEdit","customElements","define","ChaosPanelOption"],"mappings":"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"}